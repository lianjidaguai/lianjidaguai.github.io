<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>js垃圾回收机制 | lianjidaguai博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="JavaScript 自动垃圾收集机制垃圾回收又称为 GC(Garbage Collecation)。编写 JavaScript 程序时，开发者不需要手工跟踪内存的使用情况，只要按照标准写 JavaScript 代码，JavaScript 程序运行所需内存的分配以及无用内存的回收完全是自动管理。JavaScript 中自动垃圾回收机制的原理为： 找出那些不再使用的变量，然后释放其占用的内存。垃圾">
<meta name="keywords" content="js,原理">
<meta property="og:type" content="article">
<meta property="og:title" content="js垃圾回收机制">
<meta property="og:url" content="http://yoursite.com/2019/06/04/js垃圾回收机制/index.html">
<meta property="og:site_name" content="lianjidaguai博客">
<meta property="og:description" content="JavaScript 自动垃圾收集机制垃圾回收又称为 GC(Garbage Collecation)。编写 JavaScript 程序时，开发者不需要手工跟踪内存的使用情况，只要按照标准写 JavaScript 代码，JavaScript 程序运行所需内存的分配以及无用内存的回收完全是自动管理。JavaScript 中自动垃圾回收机制的原理为： 找出那些不再使用的变量，然后释放其占用的内存。垃圾">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-06-04T04:03:41.625Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="js垃圾回收机制">
<meta name="twitter:description" content="JavaScript 自动垃圾收集机制垃圾回收又称为 GC(Garbage Collecation)。编写 JavaScript 程序时，开发者不需要手工跟踪内存的使用情况，只要按照标准写 JavaScript 代码，JavaScript 程序运行所需内存的分配以及无用内存的回收完全是自动管理。JavaScript 中自动垃圾回收机制的原理为： 找出那些不再使用的变量，然后释放其占用的内存。垃圾">
  
    <link rel="alternate" href="/atom.xml" title="lianjidaguai博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">lianjidaguai博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="n-js垃圾回收机制" class="article article-type-n" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/js垃圾回收机制/" class="article-date">
  <time datetime="2019-06-04T04:02:38.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      js垃圾回收机制
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> JavaScript 自动垃圾收集机制<br>垃圾回收又称为 GC(Garbage Collecation)。编写 JavaScript 程序时，开发者不需要手工跟踪内存的使用情况，只要按照标准写 JavaScript 代码，JavaScript 程序运行所需内存的分配以及无用内存的回收完全是自动管理。JavaScript 中自动垃圾回收机制的原理为：</p>
<p>找出那些不再使用的变量，然后释放其占用的内存。<br>垃圾收集器会按照固定的时间间隔(或预定的收集时间)周期性地执行此操作。</p>
<p>局部变量的正常生命周期<br>局部变量只在函数执行的过程中存在。<br>在函数执行过程中，会为局部变量在栈内存(或 堆内存)上分配相应的空间来存储它们的值。在函数中使用这些变量，直至函数执行结束，此时可以释放局部变量的内存供将来需要时使用。<br>以上情况下，较容易判断变量是否有存在的必要，更复杂的情况需要更精细的变量追踪策略。<br>JavaScript 中的垃圾收集器必须跟踪每个变量是否有用，需要为不再有用的变量打上标记，用于将来回收其占用的内存。标识无用变量的策略通常有两个：标记清除 和 引用计数 。<br>JavaScript 中的栈内存与堆内存<br>上述过程中，JavaScript 中变量分为 基本类型值 和 引用类型值：</p>
<p>基本类型值 在内存中占固定大小的空间，因此被保存在 栈内存 中；<br>引用类型值 是对象，保存在 堆内存 中。包含引用类型值的变量实际包含并非对象本身，而是指向该对象的指针。一个变量从另一个变量复制引用类型的值时，复制的也是指向该对象的指针。</p>
<p>标记清除<br>标记清除(mark-and-sweep) 是 JavaScript 中最常用的垃圾回收方式。其执行机制如下：</p>
<p>当变量进入环境时，就将其标记为“进入环境”<br>当变量离开环境时将其标记为“离开环境”</p>
<p>逻辑上，永远不能释放进入环境的变量所占用的内存，因为执行流进入相应的环境时，可能会用到它们。<br>标记变量的方式有很多种，可以使用标记位的形式记录变量进入环境，也可单独为“进入环境”和“离开环境”添加变量列表来记录变化。<br>标记清除采用的收集策略为：</p>
<p>JavaScript中的垃圾收集器运行时会给存储在内存中的所有变量都加上标记；<br>然后去掉环境中的变量以及被环境中的变量引用的变量的标记；<br>此后，再被加上标记的变量被视为准备删除的变量；<br>最后，垃圾收集器完成内存清除，销毁那些带标记的值并回收其占用的内存空间。</p>
<p>2008年之前，IE、Firefox、Opera、Chrome 和 Safari 的 JavaScript实现使用的均为 标记清除式的垃圾回收策略，区别可能在垃圾收集的时间间隔。<br>引用计数<br>引用计数(reference counting) 是另一种垃圾收集策略。引用计数的本质是 跟踪记录每个值被引用的次数。其执行机制如下：</p>
<p>当声明一个变量并将一个引用类型值赋值给该变量时，这个值的引用次数为1；<br>若同一个值(变量)又被赋值给另一个变量，则该值的引用次数加1；<br>但是如果包含对这个值引用的变量又取得了另外一个值，则这个值的引用次数减1；<br>当这个值的引用次数为0时，则无法再访问这个值，就可回收其占用的内存空间。</p>
<p>垃圾收集器下次运行时，会释放那些引用次数为零的值所占用的内存。<br>引用计数存在一个致命的问题： 循环引用。循环引用是指，对象 A 中包含一个指向对象 B 的指针，而对象 B 中也包含一个指向对象 A 的引用。下面的代码就是标准的循环引用的例子：<br>function cycleRefernce() {<br>    var objectA = new Object();<br>    var objectB = new Object();</p>
<pre><code>objectA.someOtherObject = objectB;
objectB.anotherObject = objectA;</code></pre><p>}
复制代码上述例子中 objectA 和 objectB 通过各自属性相互引用。按照引用计数的策略，两个对象的引用次数均为 2。若采用标记清除策略，函数执行完毕，对象离开作用域就不存在相互引用。但采用引用计数后，函数执行完，两个对象的引用次数永不为0，会一直存尊内存中，若多次调用，导致大量内存得不到回收。<br>IE8浏览器 之前中有一部分对象并不是原生的 JavaScript 对象，可能是使用 C++ 以 COM 对象的形式实现的(BOM, DOM)。而 COM 对象的垃圾收集机制采用的是 引用计数策略。即使 IE 的 JavaScript 引擎是使用标记清除策略实现的，但 JavaScript 访问 COM 对象仍然是基于 引用计数策略的。在这种情况下，只要在 IE 中涉及 COM 对象，就可能存在循环引用的问题。<br>为避免出现循环引用，最好在不使用这些对象时，手动断开 原生 JavaScript 对象 与 DOM 元素之间的连接。IE中的循环引用与手动断开的操作如下所示：<br>var element = document.getElementById(“some_element”);<br>var myObject = new Object();<br>myObject.element = element;<br>element.someObject = myObject;<br>// 以上 存在循环引用<br>// ……<br>// 以下 手工断开连接<br>myObject.element = null;<br>element.someObject =null;</p>
<p>作者：skylinebin<br>链接：<a href="https://juejin.im/post/5cf4d12ee51d45775746b8ea" target="_blank" rel="noopener">https://juejin.im/post/5cf4d12ee51d45775746b8ea</a><br>来源：掘金<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/04/js垃圾回收机制/" data-id="cjwhdzde5000138uz8rjj7t0u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/原理/">原理</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/06/04/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原理/">原理</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/原理/" style="font-size: 10px;">原理</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/04/js垃圾回收机制/">js垃圾回收机制</a>
          </li>
        
          <li>
            <a href="/2019/06/04/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 lianjidaguai<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>